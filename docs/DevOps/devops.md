>如何快速地`持续交付`高质量的软件，满足用户的多样化需求，并借此提升企业的利润和市场占有率，已经成为企业必须要面对的现实问题。

软件开发过程的改进，除了依赖于技术进步，`还依赖于流程、理念、文化等全方位的改进`，而这正是 DevOps 带给软件开发方式的一场革命。

## 一.DevOps到底要解决什么问题？

首先看一下基维百科对 DevOps 的定义：

>DevOps（开发 Development 与运维 Operations 的组合词）是一种文化、一场运动或实践，强调在自动化软件交付流程及基础设施变更过程中，软件开发人员与其他信息技术（IT）专业人员彼此之间的协作与沟通。它旨在建立一种文化与环境，使构建、测试、软件发布得以快速、频繁以及更加稳定地进行。

其实，DevOps 的秘密就来源于它的名字所代表的两种角色——`开发和运维`。那么这两种角色之间究竟有什么问题呢？我们从软件工程诞生以来所历经的三个重要发展阶段说起。

### 1.瀑布式开发模式

![image](https://dyzzz.oss-cn-beijing.aliyuncs.com/img/瀑布流.png)

瀑布式开发模式将软件交付过程划分成几个阶段，从需求到开发、测试和运维，它的理念是软件开发的规模越来越大，必须以一种`工程管理`的方式来定义每个阶段，以及`相应的交付产物和交付标准`，以期通过一种重流程，重管控，按照计划一步步推进整个项目的交付过程。

可是，随着市场环境和用户需求变化的不断加速，这种按部就班的方式有一个严重的潜在问题。

*软件开发活动需要在项目一开始就确定项目目标、范围以及实现方式，而这个时间点往往是我们对用户和市场环境信息了解最少的时候，这样做出来的决策往往带有很大的不确定性，很容易导致项目范围不断变更，计划不断延期，交付上线时间不断推后，最后的结果是，即便我们投入了大量资源，却难以达到预期的效果。*

从业界巨头 IBM 的统计数字来看，有 34% 的新 IT 项目延期交付，将近一半的应用系统因为缺陷导致线上回滚，这是一件多么令人沮丧的事情。

### 2.敏捷开发模式

![image](https://dyzzz.oss-cn-beijing.aliyuncs.com/img/敏捷开发.png)

基于这种问题，敏捷的思潮开始盛行。它的核心理念是，既然我们无法充分了解用户的真实需求是怎样的，那么`不如将一个大的目标不断拆解，把它变成一个个可交付的小目标，然后通过不断迭代，以小步快跑的方式持续开发`。

与此同时，`将测试工作从研发末端的一个独立环节注入整个开发活动中`，对开发交付的内容进行`持续验证`，`保证每次可交付的都是一个可用的功能集合`，并且由于`质量内建`在研发环节中，交付功能的质量也是有保障的。

很显然，敏捷是一种更加灵活的研发模式。经常有人会问，敏捷会直接提升团队的开发速度吗？答案是否定的。试想一下，难道说采用了敏捷方法，研发编码的速度就会提高两倍甚至三倍吗？回想一下很多年前在 IT 行业广为流传的“人月神话”，我们就能发现正确的认知有多么重要。

`敏捷之所以更快，根本原因在于持续迭代和验证节省了大量不必要的浪费和返工`。

说到底，敏捷源于开发实践，敏捷的应用使得开发和测试团队抱团取暖。可是问题又来了，开发和测试团队发现，不管研发的速度变得多快，在软件交付的另一端，始终有一群人在冷冰冰地看着他们，一句“现在没到发布窗口”让多少新开发的功能倒在了上线的门槛上。

毕竟，无论开发了多少“天才”的功能，**如果没有经过运维环节的部署上线，并最终发布给真实用户，那么这些功能其实并没有什么用。**

### 3.DevOps 模式

![image](https://dyzzz.oss-cn-beijing.aliyuncs.com/img/DevOps.png)

于是，活在墙的另一端的运维团队成了被拉拢的对象。这些在软件交付最末端的团队始终处于一种“背锅”的状态，他们也有改变的意愿，所以 DevOps 应运而生，也就是说，DevOps 最开始想要打破的就是开发和运维之间的对立和隔阂。

在传统模式下，度量开发团队效率的途径就是看开发完成了多少需求。于是，开发为了达成绩效目标，当然也是为了满足业务需求，不断地堆砌新功能，却很少有时间认真思考这些功能的可运维性和可测试性，只要需求状态流转到开发完成就万事大吉了。

而对于运维团队而言，他们的考核指标却是系统的稳定性、可用性和安全性。但现代 IT 系统是如此复杂，以至于每一次的上线发布都是一场战役，整个团队如临大敌，上线失败的焦虑始终如影随形。

很多时候，我们并不知道上线之后会发生什么，只能按照部署手册一步步操作，完成之后就听天由命。所以，每逢大促活动，就会有各种“拜服务器教”的照片广为流传。

另一方面，在无数次被开发不靠谱的功能缺陷蹂躏得体无完肤之后，运维团队意识到，变更才是影响他们绩效目标的最大敌人。于是，预先设立的上线窗口就成了运维团队的自留地，不断抬高的上线门槛也使得开发团队的交付变成了不可能完成的任务，最后，“互相伤害”就成了这个故事注定的结局。

从一开始想要促进开发和运维的协作，团队慢慢发现，其实在整个软件交付过程中，不仅只有开发和运维，业务也是重要的一环。

比方说，如果业务制定了一个不靠谱的需求，那么无论开发和运维怎样协作，得到的终究是一个不靠谱的结果，以及对人力的浪费。可是业务并不清楚用户的真实情况，于是运维团队慢慢转向运营团队，他们需要持续不断地把线上的真实数据和用户行为及时地反馈给需求团队，来帮助需求团队客观评估需求的价值，并及时作出有利于产品发展的调整，这样一来，业务也被引入到了 DevOps 之中，甚至诞生了 BizDevOps 这样一个专门的词汇。

那么，既然沟通协作放之四海皆准，安全也开始积极地参与进来。安全不再是系统上线发布之后的“定时炸弹”，而是介入到整个软件开发过程中，在每个过程中注入安全反馈机制，来帮助团队在第一时间应对安全风险，那么，对于安全团队来说，DevSecOps就成了他们眼中的 DevOps。

这样的例子比比皆是，包括职能部门、战略部门等，都纷纷加入其中，使得 DevOps 由最开始的点，扩展为线，再到面，不断发展壮大。每个人都参与其中，这使得 DevOps 成了每一个 IT 从业人员都需要学习和了解的知识和技能体系。

### 总结
今天，我带你一起梳理了 DevOps 的发展历程，以及软件开发模式的变迁。有人说，DevOps 是软件工程发展至今的第三次革命，可见它带给整个行业的影响是很深远的。人云亦云并不能帮助我们更好地理解 DevOps，建立正确的认知才是体系化学习的第一步，希望你能通过今天的课程，建立起你自己对于 DevOps 的独特认知。

## 二. DevOps的价值：数字化转型时代，DevOps是必选项？

### 1.1为什么软件如此重要

软件慢慢从企业内部的支撑系统和成本中心，变成了企业服务的直接载体和利润中心。企业通过软件降低运营成本，提升服务水平，而用户在获得便利的同时，也加强了同企业之间的联系。

这本是一件双赢的事情，可问题是，我们所身处的是一个VUCA的时代，VUCA 是指易变性（Volatility）、不确定性（Uncertainty）、复杂性（Complexity）和模糊性（Ambiguity），它代表了这个时代的典型特征。比如共享单车这个行业从冉冉兴起炙手可热，到逐渐归于平静，前后不过短短几年的时间。

企业能快速满足用户的需求，在行业大势之下灵活转身，在跨界打击越发普遍的情况下脱颖而出，已经不仅仅是 good to have 的能力，而是 must have 的能力。

可以说，`软件交付的效率和质量成了当今企业的核心价值和核心竞争力`，所以，任何一家企业，无论是行业巨头还是初创公司，无论是互联网行业还是传统行业，无论是领先者还是颠覆者，都有强烈的意愿去改善自身的软件交付能力，而这恰恰和 DevOps 的理念和诞生背景不谋而合。这么看来，DevOps 能够成为企业愿望清单中的第一名也就不足为奇了吧。

可是，即便软件如此重要，却依然有很多公司在用一种手工作坊的方式开发软件，引用国家智库的某位领导的话来说，“工业革命消灭了绝大多数的手工业群体，却催生了程序员这个现存最大的手工业群体”。这句话看似危言耸听，但这种开发软件的方式的确存在，其中伴随着大量的效率浪费。企业内部的软件开发交付效率已经成了一座值得探索挖掘的金矿，效率经济可能成为新的业绩增长点。

### 2.DevOps 的价值

**2.1 高效的软件交付方式**

从 2014 年至今，这个报告每年都会发布一份，由业内大咖和行业领袖基于科学的分析方法，通过大量的数据分析得出，可以说是业内最具权威性的报告，其中的很多数据和理念都被广为传播。我发现，在这洋洋洒洒大几十页的报告中，被引用频率或者说出镜率最高的，就是 DevOps 的 4 个结果指标。

- 1.`部署频率`：指应用和服务向生产环境部署代码的频率。
- 2.`变更前置时间`：指代码从提交到成功运行在生产环境的时长。
- 3.`服务恢复时间`：指线上应用和服务出现故障到恢复运行的时长。
- 4.`变更失败率`：指应用和服务在生产环境部署失败或者部署后导致服务降级的比例。

每年，这个报告都会基于这 4 个核心指标统计行业内高效能团队和低效能团队之间的差距。从去年的数据来看，与低效能团队相比，高效能团队的部署频率高了 46 倍，变更前置时间快了 2500 多倍，服务恢复时间也快了 2600 多倍，失败率低了 7 倍。

我们先不管这份数据是怎么计算出来的，当你第一次看到这个数据的时候，它带给你的冲击是不是很强大呢？用具体的数字形式来呈现企业之间效率的差距，是很有震撼力的。

而世界上最令人“绝望”的事情，就是那些比你优秀的人，实际上比你还要更加努力。当你仔细查看这份报告的时候，你会发现，那些常年被人提及的明星公司，很多都在践行 DevOps，甚至很多来源于这些公司的实践案例，都成为了 DevOps 行业的经典案例。

另一方面，DevOps 状态报告中提到的四项结果指标，分别代表了软件交付的两个最重要的方面，也就是`交付效率`和`交付质量`。而且，从数据结果中，我们还能得到一个惊人的发现，那就是`高效能的组织不仅做到了高效率，还实现了高质量`，由此可见，鱼与熊掌可以兼得。

可是，这就颠覆了很多人心目中的“慢工出细活”的传统软件开发理念。因为按照传统软件开发的 V 模式来说，软件开发完成后，需要经过单元测试、集成测试、系统测试和验收测试等层层关卡，以此来保证软件的质量符合预期。但是，对于现代软件开发而言，如此重的流程和管控显然有点跟不上时代的节奏。

我们在不断提高软件交付效率时，往往是以牺牲质量为代价的，结果做得越多，错得越多，从而陷入进退两难的境地。

DevOps 却反其道而行之，它试图通过体系化的研发实践导入、软件架构的整体革新、组织管理理念的不断升级和企业文化的影响塑造，来帮助企业改善整个软件交付过程，`在实现高吞吐量的同时保证服务的总体稳定性，从而真正实现又快又好的软件交付目标`。

**2.2 激发团队的创造力**

>DevOps 本身也包含了改善软件从业人员的生存状态，提升他们的幸福水平的理念。

这么看来，实施 DevOps，一方面可以通过种种`流程优化和自动化能力，改善软件开发团队的工作节奏`，另一方面，也可以让大家关注同一个目标，`彼此信任，高效协作，调动员工的积极性和创新能力`，从而让整个团队进入一种积极创造价值的状态，而这所带来的影响远非建设一两个工具平台可比拟的。

### 总结

DevOps 作为软件工程的第三次革命，在数字化转型的大潮之下，几乎成了所有通过交付软件来提供服务的企业的必选项。因为，DevOps 不仅可以改善企业的软件交付过程，实现高质量和高效率兼得，同时也可以持续改善企业内部的工程师文化，提升员工信心，激发员工的活力和价值创造，从而帮助企业在 VUCA 时代占得先机，获得更大的成功。如果一家企业真的可以通过 DevOps 落地达到以上目标，而只需要多付出 10%～20% 的年终奖，岂不是大大赚到了吗？

## DevOps 的实施：到底是工具先行还是文化先行？

### DevOps 工具

随着 DevOps 理念的深入人心，各种以 DevOps 命名的工具如雨后春笋般出现在我们身边，甚至有很多老牌工具，为了顺应 DevOps 时代的发展，主动将产品名称改为 DevOps。最具代表性的，就是去年 9 月份微软研发协作平台 VSTS（Visual Studio Team Services）正式更名为 Azure DevOps，这也进一步地印证，DevOps 已经成为了各类工具平台建设的核心理念。

高效率和高质量是 DevOps 的核心价值，而工具和自动化就是提升效率最直接的手段，让一切都自动化可以说是 DevOps 的行为准则。

`一切软件交付过程中的手动环节，都是未来可以尝试进行优化的方向`。即便在运维圈里面，ITIL（IT 基础架构库） 一直是运维赖以生存的基石，也并不妨碍自动化的理念逐步深入到 ITIL 流程之中，从而在受控的基础上不断优化流程流转效率。

另外，正因为所有人都认可自动化的价值，工具平台的引入和建设就成为了 DevOps 打动人的关键因素之一。

同时，现在业界的很多开源工具已经相当成熟，以 Netflix、Amazon、Etsy 等为代表的优秀公司也在不断将内部的工具平台进行对外开放，各方面的参考资料和使用案例比比皆是。

无论是单纯使用，还是基于这些工具进行二次开发，成本都已经没那么高了，一个稍微成熟点的小团队可以在很短的时间内完成一款工具的开发。

不过，这也带来一个副作用，那就是企业内部的工具平台泛滥，很多同质化的工具在完成从 0 到 1 的过程后就停滞不前，陷入重复的怪圈，显然也是一种资源浪费。

当然，对于工具决定论的支持者来说，这并不是什么大问题，因为引入工具就是 DevOps 的最佳实施路径。

有时候，当你问别人“你们公司的 DevOps 做得怎么样啦？”你可能会得到这样的回答：“我们的所有团队都已经开始使用 Jenkins 了。”听起来感觉怪怪的。如果只是使用了最新最强大的 DevOps 工具，就能实现软件交付效率的腾飞，那么世界 500 强的公司早就实现 DevOps 了。

很多公司引入了完整的敏捷项目管理工具，但是却以传统项目管理的方式来使用这套工具，效率跟以前相比并没有明显的提升。对于自研平台来说，也是同样的道理。**如果仅仅是把线下的审批流程搬到线上执行，固然能提升一部分执行效率，但是对于企业期望的质变来说，却是相距甚远。**

说到底，工具没法解决人的问题，这样一条看似取巧的路径，却没法解决企业的根本问题。这时候，就需要文化闪亮登场了。

### DevOps 文化

在谈论 DevOps 文化之前，先分享一个故事。

上世纪 80 年代，美国加州有一家汽车制造公司，叫作 NUMMI。当时这家公司隶属于通用公司，但是由于劳资关系紧张，这家公司一直以来都是通用旗下效益最差的公司。员工整天上班喝酒，赌博，整个工厂乌烟瘴气，旷工率甚至一度达到了 20%。通用公司忍无可忍，最后关闭了这家公司。

后来，日本丰田公司想在美国联合建厂，于是跟通用达成了合资协议。美国联合汽车工会（UAW）希望新公司可以重新雇佣之前遭到解雇的员工，通用公司本来不想接受，但是令人惊讶的是，丰田公司却同意了。因为他们认为，NUMMI 工厂之前的情况更多是系统的原因，而不是人的原因。

接下来，丰田公司将新招募的员工送到日本进行培训。短短三个月后，整个公司的面貌焕然一新，半年后，一跃成为整个通用集团效益最好的公司。

由此可见，`在不同的文化制度下，相同的人发挥出来的生产力也会有天壤之别。`

类似的故事并非个例，曾经有一群美国专家到日本参观和学习生产流水线，他们发现了一件有趣的事情。

在美国公司的生产线里面，总有一个人拿着橡胶的锤子在敲打车门，目的是检查车门是否安装完好。但即便如此，车门的质量依然很差。可是，在日本公司的工厂里面，却没有这样的角色。

他们就好奇地问道：“你们如何保障车门没有问题呢？”日方的专家回复说：“我们在设计车门的时候，就已经保证它不会出问题了。”你看，同样是采用流水线技术的两家公司，结果却大不相同。

类比 DevOps，如果在我们的软件交付过程中，始终依靠这个拿锤子的人来保障产品的质量，出了问题总是抱怨没有会使用锤子的优秀人才，或许这个流程本身就出了问题。

回到文化本身，良好的文化不仅可以让流程和工具发挥更大的作用，更重要的是，它能够诱发人们思考当前的流程和工具哪里是有问题的，从而引出更多有关流程和工具的优化需求，促使流程和工具向更加有力的支持业务发展的方向持续改进。

可是，企业内部的 DevOps 文化本身就是虚无缥缈的事情，你很难去量化团队的文化水平，进而改变企业的文化。盲目地空谈文化，对组织也是一种伤害。因为脱离实践，文化就会变成无根之水。当组织迟迟无法看到 DevOps 带来的实际收益时，就会丧失转型的热情和信心。

所以，我们需要先改变行为，再通过行为来改变文化。而改变行为最关键的，就是要建立一种有效的机制。就像我一直强调的那样，机制就是人们愿意做，而且做了有好处的事情。

回想之前提到的某金融公司的案例，如果他们的老板只是喊了句口号“我们要在年底完成 DevOps 试点落地”，那么年底即便项目成功，本质上也不会有什么改变。相反，他们在内部建立了一种机制，包括 OKR 指标的设定、关键指标达成后的激励、成立专项的工作小组、引入外部的咨询顾问，以及一套客观的评判标准，这一切都保证了团队走在正确的道路上。而承载这套客观标准的就是一套通用的度量平台，`说到底，还是需要将规则内建于工具之中，并通过工具来指导实践。`

这样一来，当团队通过 DevOps 获得了实实在在的改变，那么 DevOps 所倡导的`职责共担、持续改进`的文化自然也会生根发芽。

所以你看，DevOps 中的文化和工具，本身就是一体两面，我们既不能盲目地奉行工具决定论，上来就大干快干地采购和建设工具，也不能盲目地空谈文化，在内部形成一种脱离实际的风气。

### DevOps 的3个支柱

对工具和文化的体系化认知，可以归纳到 DevOps 的 3 个支柱之中，即人（People）、流程（Process）和平台（Platform）。3 个支柱之间两两组合，构成了我们实施 DevOps 的“正确姿势”，只强调其中一个维度的重要性，明显是很片面的。

![image](https://dyzzz.oss-cn-beijing.aliyuncs.com/img/devops的三大支柱.png)

**人 + 流程 = 文化**

在具体的流程之下，人会形成一套行为准则，而这套行为准则会潜移默化地影响软件交付效率和质量的方方面面。这些行为准则组合到一起，就构成了企业内部的文化。

一种正向的文化可以弥合流程和平台方面的缺失，推动二者的持续改进，同时可以让相同的流程和平台在不同的人手中产生迥异的效果。就好像《一代宗师》里面的那句经典台词：“真正的高手，比拼的不是武功，而是思想。”而指导 DevOps 落地发展的思想，就是 DevOps 的文化了。

举个例子，在谷歌 SRE 的实践中，研发交付的应用需要自运维一段时间，并且要在达到一定的质量指标之后才会交接给 SRE 进行运维。但是，为了避免出现“研发一走，运维背锅”的情况，他们还建立了“打回”的流程，也就是当 SRE 运维一段时间后，如果发现应用稳定性不达标，就会重新交还给开发自己负责维护，这样一来，研发就会主动地保障线上应用的质量。而且在这个过程，SRE 也会给予技术和平台方面的支持，从而形成了责任共担和质量导向的文化。

类似的，有些公司设有线上安全点数的机制，在一定的额度范围内，允许团队出现问题，并且不追究责任。这就可以激励团队更加主动地完成交付活动，不必每一次都战战兢兢，生怕出错。通过流程和行为的改变，团队的文化也在慢慢地改进。

由此看来，虽然我们很难直接改变文化，但是却可以定义期望文化下的行为表现，并通过流程的改进来改变大家的行为，从而让文化得以生根发芽，茁壮成长。

>DevOps倡导职责共担的文化，但实际情况是，如果你的绩效目标跟我的半毛钱关系没有，我凭什么跟你共担责任呢？
人固然有自身的问题，到我觉得更多的还是流程和机制的设计和导向问题。
举个实际的例子，比如在梳理发布流程的时候，发现测试回归周期长，完整一次回归要两天时间，请问怎么办？
第一种就是给测试团队加人，这显然不够DevOps。
第二种就是做回归测试的自动化，这能解决一些问题，但是自动化成本，技术成熟度，自动化结果的可信度都需要时间，更何况如果自动化出了问题，责任还是人的，那么人的意愿肯定会打折扣。
第三种，就要多问几个为什么，原来回归周期长的原因是研发没有给出准确的修改范围，因为当前的流程研发提交完代码，连测试包都是测试人员自己来打，服务意识固然不错，但是问题就是你压根不知道改了啥，会影响啥，结果就是全跑一遍，因为即便出了问题，也要各种甩锅，测试责任怎么也跑不开。
所以缺陷问题只有流程上约定由研发测试一起承担，同时加入测试辅助的研发自测，将测试能力通过平台化赋能，再加上各种DevOps中的自动化手段打通变更信息，进行变更影响分析，这才能根本上解决测试和开发之间的问题。

**流程 + 平台 = 工具**
企业内部流程的标准化，是构成自动化的前提。试想一下，如果没有一套标准的规则，每一项工作都需要人介入进行判断和分析，那么结果势必会受到人的因素的影响，这样的话，又如何做到自动化呢？

而`平台的最大意义，就是承载企业内部的标准化流程`。当这些标准化流程被固化在平台之中时，所有人都能够按照一套规则沟通，沟通效率显然会大幅提升。

`平台上固化的每一种流程，其实都是可以用来解决实际问题的工具`。很多人分不清工具和平台的关系，好像只要引入或者开发了一个工具，都可以称之为平台，也正因为这样，企业内部的平台比比皆是。

实际上，平台除了有用户量、认可度、老板加持等因素之外，还会有 3 个显著特征。

- `吸附效应`：平台会不断地吸收中小型的工具，逐渐成为一个能力集合体。
- `规模效应`：平台的成本不会随着使用方的扩展而线性增加，能够实现规模化。
- `积木效应`：平台具备基础通用共享能力，能够快速搭建新的业务实现。

简单来说，平台就是搭台子，工具来唱戏。平台提供场所，进行宣传，吸引用户，同时还能提供演出的道具，以及数据方面的分析。观众的喜好各不相同，但是平台将各种戏汇集在一起，就能满足大多数人的需求。如果平台把唱戏的事情做了，难以聚焦“台子”的质量，就离倒闭不远了。同样，如果唱戏的整天琢磨着建平台，那么戏本身的品质就难以不断精进。所以是做平台，还是做工具，无关好坏，只关乎选择。

**平台 + 人 = 培训赋能**

平台是标准化流程的载体，一方面可以规范和约束员工的行为，另一方面，通过平台赋能，所有人都能以相同的操作，获得相同的结果。这样一来，跨领域之间的交接和专家就被平台所取代，当一件事情不再依赖于个人的时候，等待的浪费就会大大降低，平台就成了组织内部的能力集合体。

但与此同时，当我们定义了期望达到的目标，并提供了平台工具，那么对人的培训就变得至关重要，因为只有这样，才能让工具平台发挥最大的效用。更加重要的是，通过最终的用户使用验证，可以发现大量的可改进空间，进一步推动平台能力的提升，从而带动组织整体的飞轮效应，加速组织的进化。

所以你看，文化、工具和培训作为 DevOps 建设的 3 个重心，折射出来的是对组织流程、平台和人的关注，三位一体，缺一不可。

最后，跟你分享一个关于美国第一资本的例子。他们最初在实施 DevOps 时，采用的是外包方式，修改一个很小的问题都需要走复杂的变更流程，需要几天的时间。后来，他们决定采用“`开源为先`”的策略，并且严格审查原本的商业采购流程。除此之外，他们还基于开源工具搭建自己的平台，并在公司内部进行跨领域角色的交叉培养，交付效率大幅提升，实现了从每天迭代一次到每天多次的线上部署。





